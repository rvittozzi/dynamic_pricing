<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dynamic Pricing Calculator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Dynamic Pricing Calculator</h1>
    <div class="form-group">
      <label for="propertyUid">Select Property UID:</label>
      <select id="propertyUid" class="form-control"></select>
    </div>
    <div class="form-group">
      <label for="checkIn">Check-In Date:</label>
      <input type="date" id="checkIn" class="form-control">
    </div>
    <div class="form-group">
      <label for="checkOut">Check-Out Date:</label>
      <input type="date" id="checkOut" class="form-control">
    </div>
    <button id="calculate" class="btn btn-primary">Calculate Price</button>
    <h2 id="result"></h2>
  </div>

  <script>
    $(document).ready(function(){
      // Fetch available UIDs from the server
      $.get("/get_property_uids")
      .done(function(data) {
        const uids = data.uids;
        if (uids && Array.isArray(uids)) {
          for(const uid of uids) {
            $('#propertyUid').append(`<option value="${uid}">${uid}</option>`);
          }
        } else {
          console.log("Unexpected data format:", data);
        }
      })
      .fail(function(jqXHR, textStatus, errorThrown) {
        console.log("Failed to get property UIDs:", textStatus, errorThrown);
      });

      // Calculate the final price when the button is clicked
      $('#calculate').click(function(){
        const propertyUid = $('#propertyUid').val();
        const checkIn = $('#checkIn').val();
        const checkOut = $('#checkOut').val();
        $.ajax({
          url: "/calculate_price",
          method: "POST",
          contentType: "application/json",
          data: JSON.stringify({ propertyUid, checkIn, checkOut })
        })
        .done(function(data) {
          if (data && data.final_price != null) {
            $('#result').html(`Final Price: $${data.final_price}`);
          } else {
            console.log("Unexpected data format:", data);
          }
        })
        .fail(function(jqXHR, textStatus, errorThrown) {
          console.log("Failed to calculate price:", textStatus, errorThrown);
        });
      });
    });
  </script>
</body>
</html>
